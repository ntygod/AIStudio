# InkFlow 2.0 Backend

AIåŸç”Ÿå°è¯´åˆ›ä½œå¹³å°åç«¯æœåŠ¡ - åŸºäºç»Ÿä¸€ Agent æ¶æ„çš„æ™ºèƒ½åˆ›ä½œç³»ç»Ÿ

## ğŸ¯ äº§å“å®šä½

InkFlow 2.0 æ˜¯ä¸€ä¸ªé©å‘½æ€§çš„ AI è¾…åŠ©å°è¯´åˆ›ä½œå¹³å°ï¼Œä¸“ä¸ºé•¿ç¯‡å°è¯´åˆ›ä½œè€Œè®¾è®¡ã€‚é€šè¿‡åˆ›æ–°çš„å¯¹è¯å¼äº¤äº’ã€æ™ºèƒ½ä¸Šä¸‹æ–‡ç®¡ç†å’Œå¤š Agent ååŒï¼Œè®© AI æˆä¸ºä½œè€…çš„ä¸“ä¸šåˆ›ä½œä¼™ä¼´ã€‚

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              ç”¨æˆ·å±‚                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Web æµè§ˆå™¨  â”‚  ç§»åŠ¨ç«¯æµè§ˆå™¨  â”‚  æ¡Œé¢åº”ç”¨  â”‚  API å®¢æˆ·ç«¯                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚ HTTPS + SSE (Server-Sent Events)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API ç½‘å…³å±‚                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  JWT è®¤è¯  â”‚  ç”¨æˆ·çº§é™æµ  â”‚  ç«¯ç‚¹è§„åˆ™  â”‚  ä¼šè¯ç®¡ç†  â”‚  é”™è¯¯å¤„ç†              â”‚
â”‚            â”‚  (åŠ¨æ€é…ç½®)  â”‚  (ä¼˜å…ˆçº§)  â”‚  (Redis)   â”‚                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä¸šåŠ¡æœåŠ¡å±‚ (Spring Boot 3.5.x)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Agent æ¨¡å—  â”‚ â”‚ RAG æ£€ç´¢    â”‚ â”‚ è§’è‰²ç®¡ç†    â”‚ â”‚ é¡¹ç›®ç®¡ç†                 â”‚ â”‚
â”‚ â”‚ ç»Ÿä¸€è·¯ç”±    â”‚ â”‚ çˆ¶å­ç´¢å¼•    â”‚ â”‚ å…³ç³»å›¾è°±    â”‚ â”‚ å†…å®¹ç»“æ„                 â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ä¼ç¬”è¿½è¸ª    â”‚ â”‚ Wiki çŸ¥è¯†åº“ â”‚ â”‚ æ¼”è¿›åˆ†æ    â”‚ â”‚ Token ç›‘æ§              â”‚ â”‚
â”‚ â”‚ PlotLoop    â”‚ â”‚ å®ä½“æå–    â”‚ â”‚ çŠ¶æ€å¿«ç…§    â”‚ â”‚ ç”¨é‡ç»Ÿè®¡                 â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ è¿›åº¦ç»Ÿè®¡    â”‚ â”‚ ä¸€è‡´æ€§æ£€æŸ¥  â”‚ â”‚ ä¼šè¯æ¢å¤    â”‚ â”‚ é™æµç®¡ç†                 â”‚ â”‚
â”‚ â”‚ è¶‹åŠ¿åˆ†æ    â”‚ â”‚ CDCè§¦å‘     â”‚ â”‚ å¤šè®¾å¤‡æ”¯æŒ  â”‚ â”‚ æŒ‡æ ‡æ”¶é›†                 â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ•°æ®å­˜å‚¨å±‚                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ PostgreSQL  â”‚ â”‚ Redis Stack â”‚ â”‚ æœ¬åœ°AIæ¨¡å‹   â”‚ â”‚ å¤–éƒ¨AIæœåŠ¡               â”‚ â”‚
â”‚ â”‚ + pgvector  â”‚ â”‚ ä¼šè¯æŒä¹…åŒ–  â”‚ â”‚ Ollama      â”‚ â”‚ DeepSeek/OpenAI/Gemini  â”‚ â”‚
â”‚ â”‚ CDCè§¦å‘å™¨   â”‚ â”‚ é™æµä»¤ç‰Œæ¡¶  â”‚ â”‚ BGE/Qwen    â”‚ â”‚ åŠ¨æ€è·¯ç”±                 â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


## âœ¨ æ ¸å¿ƒåŠŸèƒ½

### ğŸ¤– ç»Ÿä¸€ Agent æ¶æ„

åŸºäº Spring AI 1.1.2 æ„å»ºçš„æ™ºèƒ½ Agent ååŒæ¡†æ¶ï¼Œé‡‡ç”¨ä¸‰å±‚æ¶æ„è®¾è®¡ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç»Ÿä¸€è¯·æ±‚å¤„ç†æµç¨‹                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  ç”¨æˆ·è¯·æ±‚                                                                    â”‚
â”‚      â”‚                                                                      â”‚
â”‚      â–¼                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Controller Layer                                  â”‚   â”‚
â”‚  â”‚  AgentController (/api/v2/agent)    ChatController (/api/v1/chat)   â”‚   â”‚
â”‚  â”‚                         â”‚                                            â”‚   â”‚
â”‚  â”‚                         â–¼                                            â”‚   â”‚
â”‚  â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚   â”‚
â”‚  â”‚              â”‚  RequestAdapterSvc  â”‚ â† è¯·æ±‚æ ¼å¼é€‚é…                   â”‚   â”‚
â”‚  â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Routing Layer                                     â”‚   â”‚
â”‚  â”‚                         â”‚                                            â”‚   â”‚
â”‚  â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚   â”‚
â”‚  â”‚              â”‚     AgentRouter     â”‚ â† ç»Ÿä¸€è·¯ç”±å…¥å£                   â”‚   â”‚
â”‚  â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚   â”‚
â”‚  â”‚                         â”‚                                            â”‚   â”‚
â”‚  â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚   â”‚
â”‚  â”‚            â–¼                         â–¼                               â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚   â”‚
â”‚  â”‚  â”‚   FastPathFilter    â”‚   â”‚   ThinkingAgent     â”‚                   â”‚   â”‚
â”‚  â”‚  â”‚   (intentHintå­˜åœ¨)   â”‚   â”‚   (éœ€è¦æ„å›¾åˆ†æ)     â”‚                   â”‚   â”‚
â”‚  â”‚  â”‚   ~10ms å¿«é€Ÿè·¯ç”±     â”‚   â”‚   è§„åˆ™å¼•æ“+å°æ¨¡å‹    â”‚                   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚   â”‚
â”‚  â”‚            â”‚                         â”‚                               â”‚   â”‚
â”‚  â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚   â”‚
â”‚  â”‚                         â”‚                                            â”‚   â”‚
â”‚  â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚   â”‚
â”‚  â”‚              â”‚  WorkflowExecutor   â”‚ â† Intent â†’ Workflow æ˜ å°„        â”‚   â”‚
â”‚  â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Workflow Layer                                    â”‚   â”‚
â”‚  â”‚                         â”‚                                            â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚                      â–¼                                      â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”‚              AbstractWorkflow                        â”‚   â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  preprocess() â†’ injectSkills() â†’ execute() â†’ post() â”‚   â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                      â”‚                                      â”‚    â”‚   â”‚
â”‚  â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚    â”‚   â”‚
â”‚  â”‚  â”‚    â–¼                 â–¼                 â–¼                   â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ ContentGeneration CreativeDesign  SimpleAgent             â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ Workflow          Workflow        Workflow                â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ (RAG+Writer+      (Planner+       (å•Agent                â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  Consistency)      WorldBuilder)   ç›´æ¥æ‰§è¡Œ)               â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Agent Layer                                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚ WriterAgent â”‚ â”‚ ChatAgent   â”‚ â”‚ PlannerAgentâ”‚ â”‚WorldBuilder â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ å†…å®¹åˆ›ä½œ    â”‚ â”‚ é€šç”¨å¯¹è¯    â”‚ â”‚ å¤§çº²è§„åˆ’    â”‚ â”‚ ä¸–ç•Œæ„å»º    â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚CharacterAgt â”‚ â”‚ConsistencyAgtâ”‚ â”‚ExtractionAgtâ”‚ â”‚ SummaryAgt â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ è§’è‰²å¡‘é€     â”‚ â”‚ ä¸€è‡´æ€§æ£€æŸ¥  â”‚ â”‚ å®ä½“æå–    â”‚ â”‚ å†…å®¹æ‘˜è¦    â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                    â”‚   â”‚
â”‚  â”‚  â”‚NameGenAgent â”‚                                                    â”‚   â”‚
â”‚  â”‚  â”‚ åå­—ç”Ÿæˆ    â”‚                                                    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                    â”‚   â”‚
â”‚  â”‚                         â”‚                                            â”‚   â”‚
â”‚  â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚   â”‚
â”‚  â”‚              â”‚   PromptInjector    â”‚ â† Skill Slots åŠ¨æ€æ³¨å…¥          â”‚   â”‚
â”‚  â”‚              â”‚   ActionSkill       â”‚   (åŠ¨ä½œæå†™/å¿ƒç†åˆ†æ/æå†™æŠ€å·§)   â”‚   â”‚
â”‚  â”‚              â”‚   PsychologySkill   â”‚                                 â”‚   â”‚
â”‚  â”‚              â”‚   DescriptionSkill  â”‚                                 â”‚   â”‚
â”‚  â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Tool & Orchestration Layer                        â”‚   â”‚
â”‚  â”‚                         â”‚                                            â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚                 ToolRegistry                                 â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  RAGSearchTool â”‚ StyleRetrieveTool â”‚ PreflightTool â”‚ CRUD   â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚                         â”‚                                            â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚              AgentOrchestrator                               â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  executeParallel() â”‚ executeChain() â”‚ executeAny()          â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  (Virtual Threads + CompletableFuture)                      â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      LLM Provider                                    â”‚   â”‚
â”‚  â”‚  DynamicChatModelFactory â†’ DeepSeek / OpenAI / Gemini / Local       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                                                â”‚
â”‚                            â–¼                                                â”‚
â”‚                    SSE æµå¼å“åº” (ç»Ÿä¸€äº‹ä»¶ç±»å‹)                               â”‚
â”‚                    content | thought | tool_start | tool_end | done | errorâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


### ğŸ¯ Agent æ¶æ„æ ¸å¿ƒç»„ä»¶

| ç»„ä»¶ | èŒè´£ | ä½ç½® |
|------|------|------|
| AgentRouter | ç»Ÿä¸€è·¯ç”±å…¥å£ï¼Œæ ¹æ®æ„å›¾åˆ†å‘è¯·æ±‚åˆ° WorkflowExecutor | `agent/routing` |
| FastPathFilter | å¿«é€Ÿè·¯ç”±ï¼ˆintentHint æˆ–å‘½ä»¤å‰ç¼€åŒ¹é…ï¼‰ | `agent/routing` |
| ThinkingAgent | æ„å›¾åˆ†æï¼ˆRuleBasedClassifier + å°æ¨¡å‹ LLMï¼‰ | `agent/routing` |
| WorkflowExecutor | å·¥ä½œæµæ‰§è¡Œå™¨ï¼Œç»´æŠ¤ Intent â†’ Workflow æ˜ å°„ | `agent/workflow` |
| AbstractWorkflow | å·¥ä½œæµåŸºç±»ï¼Œå®šä¹‰ preprocess â†’ execute â†’ postprocess æµç¨‹ | `agent/workflow` |
| ContentGenerationWorkflow | å†…å®¹ç”Ÿæˆå·¥ä½œæµï¼ˆRAG + Writer + Consistencyï¼‰ | `agent/workflow/impl` |
| CreativeDesignWorkflow | åˆ›æ„è®¾è®¡å·¥ä½œæµï¼ˆPlanner + WorldBuilderï¼‰ | `agent/workflow/impl` |
| SimpleAgentWorkflow | ç®€å•å·¥ä½œæµï¼ˆå• Agent ç›´æ¥æ‰§è¡Œï¼Œé™çº§æ–¹æ¡ˆï¼‰ | `agent/workflow/impl` |
| AgentOrchestrator | å¤š Agent ç¼–æ’ï¼ˆå¹¶è¡Œ/é“¾å¼/ç«äº‰æ‰§è¡Œï¼‰ | `agent/orchestration` |
| PromptInjector | æŠ€èƒ½æ§½æ³¨å…¥ï¼ˆæ ¹æ® Phase åŠ¨æ€åŠ è½½ Skillsï¼‰ | `agent/skill` |
| ContextBus | Session çº§åˆ«ä¸Šä¸‹æ–‡å…±äº«ï¼ˆRedis/InMemoryï¼‰ | `agent/context` |
| SSEEventBuilder | ç»Ÿä¸€ SSE äº‹ä»¶æ„å»º | `agent/event` |

### ğŸ”§ Agent ç¼–æ’èƒ½åŠ›

```java
// å¹¶è¡Œæ‰§è¡Œ (Virtual Threads + CompletableFuture)
orchestrator.executeParallel2(
    () -> writerAgent.execute(request),
    () -> consistencyAgent.execute(request)
);

// é“¾å¼æ‰§è¡Œ (ChainExecutionContext)
orchestrator.executeChainWithContext(initialInput, List.of(
    plannerAgent,
    writerAgent,
    consistencyAgent
), baseRequest);

// ç«äº‰æ‰§è¡Œ (ä»»ä¸€æˆåŠŸå³è¿”å›)
orchestrator.executeAny(
    () -> primaryProvider.call(request),
    () -> fallbackProvider.call(request)
);

// å¸¦é‡è¯•çš„æ‰§è¡Œ (æŒ‡æ•°é€€é¿: 1s, 2s, 4s...)
orchestrator.executeAgent(agent, request); // è‡ªåŠ¨é‡è¯•3æ¬¡
```

### ğŸ­ Skill ç³»ç»Ÿ

åŠ¨æ€æŠ€èƒ½æ³¨å…¥ï¼Œæ ¹æ®åˆ›ä½œé˜¶æ®µå’Œ Agent ç±»å‹è‡ªåŠ¨åŠ è½½ï¼š

| Skill | åŠŸèƒ½ | é€‚ç”¨é˜¶æ®µ |
|-------|------|----------|
| ActionSkill | åŠ¨ä½œæå†™å¢å¼ºï¼ˆç©ºé—´å¸ƒå±€ã€èŠ‚å¥æ§åˆ¶ã€æ‰“æ–—æŠ€å·§ï¼‰ | WRITING |
| PsychologySkill | å¿ƒç†æå†™æŒ‡å—ï¼ˆå†…å¿ƒç‹¬ç™½ã€æƒ…æ„Ÿå±‚æ¬¡ã€æ½œæ„è¯†ï¼‰ | WRITING |
| DescriptionSkill | ç¯å¢ƒæå†™æŠ€å·§ï¼ˆäº”æ„Ÿæå†™ã€æ°›å›´è¥é€ ï¼‰ | WRITING |



### ğŸ” RAG çˆ¶å­ç´¢å¼•æ¶æ„

åˆ›æ–°çš„æ£€ç´¢å¢å¼ºç”Ÿæˆç³»ç»Ÿï¼Œè§£å†³ä¼ ç»Ÿ RAG çš„"æ£€ç´¢ç²’åº¦å›°å¢ƒ"ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         çˆ¶å­ç´¢å¼•æ¶æ„ (Parent-Child Index)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                        ç´¢å¼•æ„å»ºæµç¨‹                                   â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  StoryBlock/WikiEntry åˆ›å»º/æ›´æ–°                                       â”‚   â”‚
â”‚  â”‚         â”‚                                                             â”‚   â”‚
â”‚  â”‚         â–¼                                                             â”‚   â”‚
â”‚  â”‚  ParentChildSearchService.createParentChildIndex()                    â”‚   â”‚
â”‚  â”‚         â”‚                                                             â”‚   â”‚
â”‚  â”‚         â”œâ”€â”€â–¶ 1. åˆ é™¤æ—§ç´¢å¼• (deleteBySourceId)                         â”‚   â”‚
â”‚  â”‚         â”‚                                                             â”‚   â”‚
â”‚  â”‚         â”œâ”€â”€â–¶ 2. åˆ›å»ºçˆ¶å— (å®Œæ•´å†…å®¹, æ— å‘é‡)                            â”‚   â”‚
â”‚  â”‚         â”‚                                                             â”‚   â”‚
â”‚  â”‚         â””â”€â”€â–¶ 3. SemanticChunkingService è¯­ä¹‰åˆ†å—                      â”‚   â”‚
â”‚  â”‚                  â”‚                                                    â”‚   â”‚
â”‚  â”‚                  â””â”€â”€â–¶ åˆ›å»ºå­å— (è¯­ä¹‰ç‰‡æ®µ + å‘é‡)                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚   çˆ¶å— (Parent)   â”‚              â”‚   å­å— (Child)    â”‚                    â”‚
â”‚  â”‚                  â”‚              â”‚                  â”‚                    â”‚
â”‚  â”‚ â€¢ StoryBlock å®Œæ•´ â”‚    1:N       â”‚ â€¢ è¯­ä¹‰åˆ‡åˆ†ç‰‡æ®µ    â”‚                    â”‚
â”‚  â”‚ â€¢ ä¸å­˜å‚¨å‘é‡      â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â€¢ å­˜å‚¨å‘é‡æ£€ç´¢    â”‚                    â”‚
â”‚  â”‚ â€¢ æ£€ç´¢æ—¶è¿”å›      â”‚              â”‚ â€¢ ç²¾å‡†å®šä½åŒ¹é…    â”‚                    â”‚
â”‚  â”‚ â€¢ ä¿æŒè¯­ä¹‰å®Œæ•´    â”‚              â”‚ â€¢ è¯­ä¹‰æ–­å´–åˆ‡åˆ†    â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                                             â”‚
â”‚  æ£€ç´¢ç­–ç•¥: å°å—æ£€ç´¢ â†’ æŒ‰çˆ¶å—å»é‡ â†’ ä¿ç•™æœ€é«˜åˆ† â†’ è¿”å›çˆ¶å—å®Œæ•´å†…å®¹            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒæœåŠ¡ç»„ä»¶**:

| æœåŠ¡ | èŒè´£ | è¯´æ˜ |
|------|------|------|
| HybridSearchService | æ··åˆæ£€ç´¢å…¥å£ | RRFèåˆå‘é‡+å…¨æ–‡æ£€ç´¢ï¼Œé…ç½®é©±åŠ¨ç­–ç•¥é€‰æ‹© |
| ParentChildSearchService | çˆ¶å­å—æ£€ç´¢ | å°å—æ£€ç´¢å¤§å—è¿”å›ï¼Œå»é‡+æ’åº |
| SemanticChunkingService | è¯­ä¹‰åˆ†å— | æ–­å´–æ£€æµ‹ï¼Œæ™ºèƒ½åˆ‡åˆ† |
| EmbeddingService | å‘é‡ç”Ÿæˆ | æ‰¹é‡embeddingï¼Œå¤šçº§ç¼“å­˜ |
| RerankerService | é‡æ’åº | BGE-Rerankerï¼Œå¯é€‰å¯ç”¨ |
| FullTextSearchService | å…¨æ–‡æ£€ç´¢ | PostgreSQL FTS |

**é…ç½®é©±åŠ¨çš„æ£€ç´¢ç­–ç•¥**:

```yaml
inkflow:
  rag:
    search:
      use-parent-child: true  # å¯ç”¨çˆ¶å­å—æ£€ç´¢ç­–ç•¥
    hybrid-search:
      rrf-k: 60               # RRF èåˆå¸¸æ•°
      vector-weight: 0.7      # å‘é‡æƒé‡
      keyword-weight: 0.3     # å…³é”®è¯æƒé‡
      enable-reranker: true   # å¯ç”¨é‡æ’åº
```

### ğŸ­ è§’è‰²ç®¡ç†ç³»ç»Ÿ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    è§’è‰²ç®¡ç†æ¶æ„                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ è§’è‰²åŸå‹    â”‚    â”‚ è§’è‰²å®ä½“    â”‚    â”‚ å…³ç³»å›¾è°±    â”‚         â”‚
â”‚  â”‚ Archetype   â”‚â”€â”€â”€â–¶â”‚ Character   â”‚â”€â”€â”€â–¶â”‚ Graph       â”‚         â”‚
â”‚  â”‚ 8ç§é¢„è®¾æ¨¡æ¿ â”‚    â”‚ åŠ¨æ€å±æ€§    â”‚    â”‚ BFSéå†     â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                 â”‚
â”‚  åŸå‹ç±»å‹: å«è„šçŸ³ | è€çˆ·çˆ· | æ¬¢å–œå†¤å®¶ | çº¿äºº | å®ˆé—¨äºº | ...     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“ ä¼ç¬”è¿½è¸ªç³»ç»Ÿ

```
çŠ¶æ€æµè½¬: OPEN â†’ URGENT â†’ CLOSED
                  â†“
              ABANDONED

â€¢ å¼€æ”¾(OPEN): å·²è®¾ç½®ä½†æœªå›æ”¶
â€¢ ç´§æ€¥(URGENT): é•¿æ—¶é—´æœªå¤„ç†ï¼Œè‡ªåŠ¨æé†’
â€¢ å…³é—­(CLOSED): å·²æˆåŠŸå›æ”¶
â€¢ æ”¾å¼ƒ(ABANDONED): å†³å®šä¸å†å¤„ç†
```


## ğŸ› ï¸ æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|
| Java | 22 LTS | Virtual Threads, Pattern Matching |
| Spring Boot | 3.5.8 | åŸºäº Spring Framework 6.2 |
| Spring AI | 1.1.2 | ChatClient, Advisors, Function Calling |
| PostgreSQL | 18 | pgvector (HNSWç´¢å¼•), JSONB, CDC |
| Redis Stack | 7.4+ | å‘é‡ç¼“å­˜, JSONæ“ä½œ, ä¼šè¯ç®¡ç† |
| jqwik | 1.9.0 | å±æ€§æµ‹è¯•æ¡†æ¶ |

## ğŸ“ é¡¹ç›®ç»“æ„

```
inkflow-backend-v2/
â”œâ”€â”€ src/main/java/com/inkflow/
â”‚   â”œâ”€â”€ common/                    # å…¬å…±æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ entity/                # åŸºç¡€å®ä½“ (BaseEntity)
â”‚   â”‚   â”œâ”€â”€ exception/             # å…¨å±€å¼‚å¸¸å¤„ç†
â”‚   â”‚   â””â”€â”€ util/                  # å·¥å…·ç±» (HalfVecType, CryptoUtil)
â”‚   â”œâ”€â”€ config/                    # é…ç½®ç±»
â”‚   â”‚   â”œâ”€â”€ AsyncConfig.java       # è™šæ‹Ÿçº¿ç¨‹æ‰§è¡Œå™¨
â”‚   â”‚   â”œâ”€â”€ CacheConfig.java       # å¤šçº§ç¼“å­˜é…ç½®
â”‚   â”‚   â”œâ”€â”€ RedisConfig.java       # Redisåºåˆ—åŒ–
â”‚   â”‚   â””â”€â”€ SecurityConfig.java    # Spring Security
â”‚   â””â”€â”€ module/                    # ä¸šåŠ¡æ¨¡å—
â”‚       â”œâ”€â”€ agent/                 # ğŸ†• ç»Ÿä¸€ Agent æ¨¡å—
â”‚       â”‚   â”œâ”€â”€ config/            # Agent é…ç½®
â”‚       â”‚   â”œâ”€â”€ context/           # ä¸Šä¸‹æ–‡æ€»çº¿ (ContextBus, SessionContext)
â”‚       â”‚   â”œâ”€â”€ controller/        # AgentController
â”‚       â”‚   â”œâ”€â”€ core/              # Agent åŸºç±» (BaseAgent, Intent, AgentCapability)
â”‚       â”‚   â”œâ”€â”€ dto/               # æ•°æ®ä¼ è¾“å¯¹è±¡ (ChatRequest, ChatResponse)
â”‚       â”‚   â”œâ”€â”€ event/             # SSE äº‹ä»¶ (SSEEvent, SSEEventBuilder)
â”‚       â”‚   â”œâ”€â”€ impl/              # Agent å®ç° (9ç§)
â”‚       â”‚   â”‚   â”œâ”€â”€ WriterAgent        # å†…å®¹åˆ›ä½œ
â”‚       â”‚   â”‚   â”œâ”€â”€ ChatAgent          # é€šç”¨å¯¹è¯
â”‚       â”‚   â”‚   â”œâ”€â”€ PlannerAgent       # å¤§çº²è§„åˆ’
â”‚       â”‚   â”‚   â”œâ”€â”€ WorldBuilderAgent  # ä¸–ç•Œæ„å»º
â”‚       â”‚   â”‚   â”œâ”€â”€ CharacterAgent     # è§’è‰²å¡‘é€ 
â”‚       â”‚   â”‚   â”œâ”€â”€ ConsistencyAgent   # ä¸€è‡´æ€§æ£€æŸ¥
â”‚       â”‚   â”‚   â”œâ”€â”€ ExtractionAgent    # å®ä½“æå–
â”‚       â”‚   â”‚   â”œâ”€â”€ SummaryAgent       # å†…å®¹æ‘˜è¦
â”‚       â”‚   â”‚   â””â”€â”€ NameGeneratorAgent # åå­—ç”Ÿæˆ
â”‚       â”‚   â”œâ”€â”€ lazy/              # æ‡’æ‰§è¡Œç®¡ç†
â”‚       â”‚   â”œâ”€â”€ orchestration/     # ç¼–æ’å™¨ (AgentOrchestrator)
â”‚       â”‚   â”‚   â”œâ”€â”€ chain/         # é“¾å¼æ‰§è¡Œä¸Šä¸‹æ–‡ (ChainExecutionContext)
â”‚       â”‚   â”‚   â””â”€â”€ dto/           # ç¼–æ’ DTO (AgentOutput, ParallelResult)
â”‚       â”‚   â”œâ”€â”€ routing/           # è·¯ç”±å±‚
â”‚       â”‚   â”‚   â”œâ”€â”€ AgentRouter        # ç»Ÿä¸€è·¯ç”±å…¥å£
â”‚       â”‚   â”‚   â”œâ”€â”€ FastPathFilter     # å¿«é€Ÿè·¯ç”±
â”‚       â”‚   â”‚   â”œâ”€â”€ ThinkingAgent      # æ„å›¾åˆ†æ
â”‚       â”‚   â”‚   â””â”€â”€ RuleBasedClassifier # è§„åˆ™å¼•æ“
â”‚       â”‚   â”œâ”€â”€ service/           # æœåŠ¡ (RequestAdapterService)
â”‚       â”‚   â”œâ”€â”€ skill/             # æŠ€èƒ½ç³»ç»Ÿ
â”‚       â”‚   â”‚   â”œâ”€â”€ PromptInjector     # æŠ€èƒ½æ³¨å…¥å™¨
â”‚       â”‚   â”‚   â”œâ”€â”€ SkillRegistry      # æŠ€èƒ½æ³¨å†Œè¡¨
â”‚       â”‚   â”‚   â”œâ”€â”€ AbstractSkillSlot  # æŠ€èƒ½æ§½åŸºç±»
â”‚       â”‚   â”‚   â””â”€â”€ impl/              # æŠ€èƒ½å®ç° (Action/Psychology/Description)
â”‚       â”‚   â”œâ”€â”€ tool/              # å·¥å…·æ³¨å†Œ (ToolRegistry)
â”‚       â”‚   â””â”€â”€ workflow/          # å·¥ä½œæµå±‚
â”‚       â”‚       â”œâ”€â”€ WorkflowExecutor   # å·¥ä½œæµæ‰§è¡Œå™¨
â”‚       â”‚       â”œâ”€â”€ AbstractWorkflow   # å·¥ä½œæµåŸºç±»
â”‚       â”‚       â”œâ”€â”€ WorkflowType       # å·¥ä½œæµç±»å‹æšä¸¾
â”‚       â”‚       â””â”€â”€ impl/              # å·¥ä½œæµå®ç°
â”‚       â”‚           â”œâ”€â”€ ContentGenerationWorkflow  # å†…å®¹ç”Ÿæˆ
â”‚       â”‚           â”œâ”€â”€ CreativeDesignWorkflow     # åˆ›æ„è®¾è®¡
â”‚       â”‚           â””â”€â”€ SimpleAgentWorkflow        # ç®€å•æ‰§è¡Œ
â”‚       â”œâ”€â”€ ai_bridge/             # AI æ¡¥æ¥æ¨¡å— (å…¼å®¹å±‚)
â”‚       â”‚   â”œâ”€â”€ adapter/           # é¢†åŸŸé€‚é…å™¨
â”‚       â”‚   â”œâ”€â”€ chat/              # èŠå¤©æœåŠ¡ (DynamicChatModelFactory)
â”‚       â”‚   â”œâ”€â”€ memory/            # å¯¹è¯è®°å¿† (PersistentChatMemory)
â”‚       â”‚   â””â”€â”€ tool/              # Function Calling å·¥å…·
â”‚       â”œâ”€â”€ auth/                  # è®¤è¯æˆæƒ
â”‚       â”œâ”€â”€ character/             # è§’è‰²ç®¡ç†
â”‚       â”œâ”€â”€ consistency/           # ä¸€è‡´æ€§æ£€æŸ¥ (CDCè§¦å‘, è­¦å‘Šç®¡ç†)
â”‚       â”œâ”€â”€ content/               # å†…å®¹ç»“æ„ (Volume/Chapter/StoryBlock)
â”‚       â”œâ”€â”€ evolution/             # æ¼”è¿›åˆ†æ
â”‚       â”œâ”€â”€ extraction/            # å®ä½“æå–
â”‚       â”œâ”€â”€ plotloop/              # ä¼ç¬”è¿½è¸ª
â”‚       â”œâ”€â”€ progress/              # è¿›åº¦ç»Ÿè®¡
â”‚       â”œâ”€â”€ project/               # é¡¹ç›®ç®¡ç†
â”‚       â”œâ”€â”€ rag/                   # RAG æ£€ç´¢ (çˆ¶å­ç´¢å¼•æ¶æ„)
â”‚       â”‚   â”œâ”€â”€ config/            # é…ç½® (RagProperties)
â”‚       â”‚   â”œâ”€â”€ controller/        # API (RagController)
â”‚       â”‚   â”œâ”€â”€ dto/               # æ•°æ®ä¼ è¾“ (SearchResult)
â”‚       â”‚   â”œâ”€â”€ entity/            # å®ä½“ (KnowledgeChunk)
â”‚       â”‚   â”œâ”€â”€ repository/        # ä»“å‚¨ (å‘é‡æœç´¢)
â”‚       â”‚   â””â”€â”€ service/           # æœåŠ¡
â”‚       â”‚       â”œâ”€â”€ HybridSearchService      # æ··åˆæ£€ç´¢å…¥å£
â”‚       â”‚       â”œâ”€â”€ ParentChildSearchService # çˆ¶å­å—æ£€ç´¢
â”‚       â”‚       â”œâ”€â”€ SemanticChunkingService  # è¯­ä¹‰åˆ†å—
â”‚       â”‚       â”œâ”€â”€ EmbeddingService         # å‘é‡ç”Ÿæˆ
â”‚       â”‚       â”œâ”€â”€ EmbeddingCacheService    # å‘é‡ç¼“å­˜
â”‚       â”‚       â”œâ”€â”€ RerankerService          # é‡æ’åº
â”‚       â”‚       â””â”€â”€ FullTextSearchService    # å…¨æ–‡æ£€ç´¢
â”‚       â”œâ”€â”€ ratelimit/             # é™æµç®¡ç†
â”‚       â”œâ”€â”€ session/               # ä¼šè¯ç®¡ç†
â”‚       â”œâ”€â”€ usage/                 # Token ç›‘æ§
â”‚       â””â”€â”€ wiki/                  # çŸ¥è¯†åº“
â””â”€â”€ src/test/                      # æµ‹è¯•ä»£ç 
```



## ğŸ”„ æ ¸å¿ƒæ‰§è¡Œæµç¨‹

### ç»Ÿä¸€èŠå¤©æµç¨‹ (æ–°æ¶æ„)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç»Ÿä¸€èŠå¤©è¯·æ±‚æµç¨‹ (AgentRouter)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  1. ç”¨æˆ·å‘é€æ¶ˆæ¯                                                             â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â–¼                                                                       â”‚
â”‚  2. AgentController / ChatController æ¥æ”¶è¯·æ±‚                                â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â–¼                                                                       â”‚
â”‚  3. RequestAdapterService.adapt()                                           â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â”œâ”€â”€â–¶ 3.1 PhaseInferenceService æ¨æ–­åˆ›ä½œé˜¶æ®µ (if missing)                â”‚
â”‚     â”œâ”€â”€â–¶ 3.2 ç”Ÿæˆ sessionId (if missing)                                    â”‚
â”‚     â””â”€â”€â–¶ 3.3 æ„å»º metadata (userId, projectId, source)                      â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â–¼                                                                       â”‚
â”‚  4. AgentRouter.route(request)                                              â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â”œâ”€â”€â–¶ 4.1 FastPathFilter.tryFastPath()                                   â”‚
â”‚     â”‚        â€¢ æ£€æŸ¥ intentHint â†’ ç›´æ¥è¿”å› Intent (~10ms)                    â”‚
â”‚     â”‚        â€¢ æ£€æŸ¥å‘½ä»¤å‰ç¼€ (/ç”Ÿæˆ, /æ£€æŸ¥ ç­‰)                                â”‚
â”‚     â”‚    æˆ–                                                                 â”‚
â”‚     â””â”€â”€â–¶ 4.2 ThinkingAgent.analyze()                                        â”‚
â”‚              â”‚                                                              â”‚
â”‚              â”œâ”€â”€â–¶ RuleBasedClassifier è§„åˆ™åŒ¹é… (<10ms)                      â”‚
â”‚              â”‚    (confidence > 0.9 ç›´æ¥è¿”å›)                               â”‚
â”‚              â”‚                                                              â”‚
â”‚              â””â”€â”€â–¶ å°æ¨¡å‹ LLM åˆ†æ (~500ms)                                  â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â–¼                                                                       â”‚
â”‚  5. WorkflowExecutor.execute(intent, request)                               â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â”œâ”€â”€â–¶ 5.1 selectWorkflow(intent) é€‰æ‹©å·¥ä½œæµ                              â”‚
â”‚     â”‚        â€¢ Intent â†’ Workflow æ˜ å°„è¡¨æŸ¥æ‰¾                                 â”‚
â”‚     â”‚        â€¢ æœªæ‰¾åˆ°åˆ™é™çº§åˆ° SimpleAgentWorkflow                           â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â””â”€â”€â–¶ 5.2 workflow.execute(request)                                      â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â–¼                                                                       â”‚
â”‚  6. AbstractWorkflow.execute() æ¨¡æ¿æ–¹æ³•                                      â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â”œâ”€â”€â–¶ 6.1 preprocess() é¢„å¤„ç†                                            â”‚
â”‚     â”‚        â€¢ RAG æ£€ç´¢ç›¸å…³è®¾å®š                                             â”‚
â”‚     â”‚        â€¢ è·å–è§’è‰²çŠ¶æ€                                                 â”‚
â”‚     â”‚        â€¢ è·å–é£æ ¼æ ·æœ¬                                                 â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â”œâ”€â”€â–¶ 6.2 injectSkills() æŠ€èƒ½æ³¨å…¥                                        â”‚
â”‚     â”‚        â€¢ PromptInjector.autoSelectSkills()                            â”‚
â”‚     â”‚        â€¢ æ ¹æ® Phase + Agent ç±»å‹åŠ¨æ€åŠ è½½                              â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â”œâ”€â”€â–¶ 6.3 mainAgent.stream() ä¸» Agent æ‰§è¡Œ                               â”‚
â”‚     â”‚        â€¢ DynamicChatModelFactory è·å– ChatModel                       â”‚
â”‚     â”‚        â€¢ ChatClient.stream() æµå¼è°ƒç”¨ LLM                             â”‚
â”‚     â”‚        â€¢ Tool Calling (æŒ‰éœ€)                                          â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â””â”€â”€â–¶ 6.4 postprocess() åå¤„ç†                                           â”‚
â”‚              â€¢ ä¸€è‡´æ€§æ£€æŸ¥ (ContentGenerationWorkflow)                       â”‚
â”‚              â€¢ å‘é€ check_result äº‹ä»¶                                       â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â–¼                                                                       â”‚
â”‚  7. SSE æµå¼å“åº” (SSEEventBuilder ç»Ÿä¸€æ„å»º)                                  â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â”œâ”€â”€â–¶ event: thought   {"agent": "WriterAgent", "message": "..."}        â”‚
â”‚     â”œâ”€â”€â–¶ event: tool_start {"tool": "RAGSearchTool"}                        â”‚
â”‚     â”œâ”€â”€â–¶ event: tool_end   {"tool": "RAGSearchTool", "result": "..."}       â”‚
â”‚     â”œâ”€â”€â–¶ event: content    "ç”Ÿæˆçš„å†…å®¹..."                                  â”‚
â”‚     â”œâ”€â”€â–¶ event: check_result {"warnings": [...]}                            â”‚
â”‚     â”œâ”€â”€â–¶ event: done       {"tokens": 1500, "model": "deepseek-chat"}       â”‚
â”‚     â””â”€â”€â–¶ event: error      {"message": "ç”¨æˆ·å‹å¥½é”™è¯¯ä¿¡æ¯"}                   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


### å†…å®¹ç”Ÿæˆå·¥ä½œæµ (ContentGenerationWorkflow)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å†…å®¹ç”Ÿæˆå·¥ä½œæµ (ContentGenerationWorkflow)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  Intent: WRITE_CONTENT                                                      â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â–¼                                                                       â”‚
â”‚  1. preprocess() - å¹¶è¡Œé¢„å¤„ç† (Mono.zip + Schedulers.boundedElastic)        â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â”œâ”€â”€â–¶ Task 1: HybridSearchService.search()                               â”‚
â”‚     â”‚        â€¢ çˆ¶å­å—æ£€ç´¢ç­–ç•¥                                               â”‚
â”‚     â”‚        â€¢ RRF èåˆå‘é‡+å…¨æ–‡                                            â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â”œâ”€â”€â–¶ Task 2: StateRetrievalService.getCharacterStates()                 â”‚
â”‚     â”‚        â€¢ è·å–é¡¹ç›®è§’è‰²æœ€æ–°çŠ¶æ€                                         â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â””â”€â”€â–¶ Task 3: HybridSearchService.buildContextForGeneration()            â”‚
â”‚              â€¢ è·å–é£æ ¼æ ·æœ¬                                                 â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â–¼                                                                       â”‚
â”‚  2. injectSkills() - æŠ€èƒ½æ³¨å…¥                                                â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â””â”€â”€â–¶ PromptInjector.autoSelectSkills(WRITING, WriterAgent)              â”‚
â”‚              â€¢ ActionSkill (åŠ¨ä½œæå†™)                                       â”‚
â”‚              â€¢ PsychologySkill (å¿ƒç†æå†™)                                   â”‚
â”‚              â€¢ DescriptionSkill (ç¯å¢ƒæå†™)                                  â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â–¼                                                                       â”‚
â”‚  3. WriterAgent.stream() - æµå¼ç”Ÿæˆ                                          â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â””â”€â”€â–¶ ChatClient.stream()                                                â”‚
â”‚              â€¢ System Prompt + Skill Prompts                                â”‚
â”‚              â€¢ RAG Context + Character States                               â”‚
â”‚              â€¢ User Message                                                 â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â–¼                                                                       â”‚
â”‚  4. postprocess() - åŒæ­¥åå¤„ç† (åœ¨ done ä¹‹å‰)                                â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â””â”€â”€â–¶ ConsistencyAgent.execute()                                         â”‚
â”‚              â€¢ æ£€æŸ¥ç”Ÿæˆå†…å®¹ä¸è®¾å®šçš„ä¸€è‡´æ€§                                   â”‚
â”‚              â€¢ è§£æè­¦å‘Šä¿¡æ¯                                                 â”‚
â”‚              â€¢ å‘é€ check_result äº‹ä»¶                                       â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â–¼                                                                       â”‚
â”‚  5. è¿”å› Flux<ServerSentEvent<String>>                                       â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### RAG æ··åˆæ£€ç´¢æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           RAG æ··åˆæ£€ç´¢æµç¨‹                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  1. æŸ¥è¯¢è¯·æ±‚                                                                 â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â–¼                                                                       â”‚
â”‚  2. HybridSearchService.search()                                            â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â”œâ”€â”€â–¶ æ£€æŸ¥é…ç½®: ragProperties.search().useParentChild()                  â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚     â”‚                  â”‚                  â”‚                                 â”‚
â”‚     â–¼                  â–¼                  â–¼                                 â”‚
â”‚  å‘é‡æ£€ç´¢           å…¨æ–‡æ£€ç´¢          (å¹¶è¡Œæ‰§è¡Œ)                              â”‚
â”‚  (ç­–ç•¥é€‰æ‹©)        (FullTextSearch)                                         â”‚
â”‚     â”‚                  â”‚                                                    â”‚
â”‚     â”œâ”€ useParentChild=true â”€â”€â–¶ ParentChildSearchService.search()            â”‚
â”‚     â”‚   â€¢ å­å—å‘é‡æ£€ç´¢                                                       â”‚
â”‚     â”‚   â€¢ æŒ‰çˆ¶å—å»é‡ (ä¿ç•™æœ€é«˜åˆ†)                                            â”‚
â”‚     â”‚   â€¢ è¿”å›çˆ¶å—å®Œæ•´å†…å®¹                                                   â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â””â”€ useParentChild=false â”€â–¶ EmbeddingService.searchWithScore()           â”‚
â”‚         â€¢ ä¼ ç»Ÿå‘é‡æ£€ç´¢                                                       â”‚
â”‚         â€¢ ç›´æ¥è¿”å›åŒ¹é…å—                                                     â”‚
â”‚     â”‚                  â”‚                                                    â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                        â”‚                                                    â”‚
â”‚                        â–¼                                                    â”‚
â”‚  3. RRF èåˆç®—æ³• (Reciprocal Rank Fusion)                                   â”‚
â”‚     Score = 1.0 / (k + rank), k=60                                          â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â–¼                                                                       â”‚
â”‚  4. RerankerService é‡æ’åº (å¯é€‰, BGE-Reranker)                              â”‚
â”‚     â”‚                                                                       â”‚
â”‚     â–¼                                                                       â”‚
â”‚  5. è¿”å› SearchResult åˆ—è¡¨                                                   â”‚
â”‚     â€¢ sourceId: åŸå§‹å†…å®¹ID                                                   â”‚
â”‚     â€¢ content: çˆ¶å—å®Œæ•´å†…å®¹                                                  â”‚
â”‚     â€¢ similarity: æœ€é«˜å­å—ç›¸ä¼¼åº¦                                             â”‚
â”‚     â€¢ metadata: æ ‡é¢˜/ç±»å‹ç­‰å…ƒæ•°æ®                                            â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å†…å®¹ç´¢å¼•ç”Ÿå‘½å‘¨æœŸ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         å†…å®¹ç´¢å¼•è‡ªåŠ¨ç®¡ç†                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    StoryBlock ç´¢å¼•æµç¨‹                                â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  createBlock() / updateContent()                                      â”‚   â”‚
â”‚  â”‚         â”‚                                                             â”‚   â”‚
â”‚  â”‚         â””â”€â”€â–¶ @Async triggerIndexing(block)                            â”‚   â”‚
â”‚  â”‚                  â”‚                                                    â”‚   â”‚
â”‚  â”‚                  â””â”€â”€â–¶ ParentChildSearchService.createParentChildIndex â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  deleteBlock()                                                        â”‚   â”‚
â”‚  â”‚         â”‚                                                             â”‚   â”‚
â”‚  â”‚         â””â”€â”€â–¶ @Async triggerIndexDeletion(blockId)                     â”‚   â”‚
â”‚  â”‚                  â”‚                                                    â”‚   â”‚
â”‚  â”‚                  â””â”€â”€â–¶ knowledgeChunkRepository.deleteBySourceId       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    WikiEntry ç´¢å¼•æµç¨‹                                 â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  WikiEntryService.create() / update()                                 â”‚   â”‚
â”‚  â”‚         â”‚                                                             â”‚   â”‚
â”‚  â”‚         â””â”€â”€â–¶ å‘å¸ƒ WikiEntryChangedEvent                               â”‚   â”‚
â”‚  â”‚                  â”‚                                                    â”‚   â”‚
â”‚  â”‚                  â””â”€â”€â–¶ WikiChangeListener.handleWikiEntryChanged()     â”‚   â”‚
â”‚  â”‚                           â”‚                                           â”‚   â”‚
â”‚  â”‚                           â”œâ”€ CREATED/UPDATED: triggerEmbeddingGeneration â”‚
â”‚  â”‚                           â”‚       â””â”€â”€â–¶ createParentChildIndex         â”‚   â”‚
â”‚  â”‚                           â”‚                                           â”‚   â”‚
â”‚  â”‚                           â””â”€ DELETED: cleanupEmbeddings               â”‚   â”‚
â”‚  â”‚                                   â””â”€â”€â–¶ deleteBySourceId               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- JDK 22+
- Maven 3.9+
- PostgreSQL 18+ (with pgvector extension)
- Redis Stack 7.4+

### é…ç½®ç¯å¢ƒå˜é‡

```bash
# æ•°æ®åº“é…ç½®
export DB_HOST=localhost
export DB_PORT=5432
export DB_NAME=inkflow
export DB_USERNAME=inkflow
export DB_PASSWORD=inkflow

# Redisé…ç½®
export REDIS_HOST=localhost
export REDIS_PORT=6379

# AIé…ç½® (é€‰æ‹©ä¸€ä¸ªæˆ–å¤šä¸ª)
export OPENAI_API_KEY=your-api-key
export DEEPSEEK_API_KEY=your-api-key
export GEMINI_API_KEY=your-api-key

# JWTé…ç½®
export JWT_SECRET=your-256-bit-secret-key
```

### å¯åŠ¨åº”ç”¨

```bash
# ç¼–è¯‘é¡¹ç›®
mvn clean compile

# è¿è¡Œæµ‹è¯•
mvn test

# å¯åŠ¨åº”ç”¨
mvn spring-boot:run
```



## ğŸ“Š API ç«¯ç‚¹æ¦‚è§ˆ

### AI èŠå¤©æ¨¡å— (ç»Ÿä¸€å…¥å£)
| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ |
|------|------|------|
| POST | /api/v2/agent/chat | Agent ç»Ÿä¸€å…¥å£ (é€šè¿‡ AgentRouter) |
| POST | /api/v1/chat/stream | æµå¼å¯¹è¯ (SSE) |
| POST | /api/v1/chat/simple | åŒæ­¥å¯¹è¯ |

### åœºæ™¯åˆ›ä½œæ¨¡å—
| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ |
|------|------|------|
| POST | /api/v1/scenes | åˆ›å»ºåœºæ™¯ï¼ˆåŒæ­¥ï¼‰ |
| POST | /api/v1/scenes/stream | åˆ›å»ºåœºæ™¯ï¼ˆæµå¼ï¼‰ |
| POST | /api/v1/scenes/quick | å¿«é€Ÿåˆ›å»ºï¼ˆè·³è¿‡åˆ†æï¼‰ |
| POST | /api/v1/scenes/with-consistency | åˆ›å»ºåœºæ™¯ï¼ˆå«ä¸€è‡´æ€§æ£€æŸ¥ï¼‰ |

### è®¤è¯æ¨¡å—
| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ |
|------|------|------|
| POST | /api/auth/register | ç”¨æˆ·æ³¨å†Œ |
| POST | /api/auth/login | ç”¨æˆ·ç™»å½• |
| POST | /api/auth/refresh | åˆ·æ–°ä»¤ç‰Œ |
| POST | /api/auth/logout | ç™»å‡º |
| GET | /api/auth/me | è·å–å½“å‰ç”¨æˆ· |

### é¡¹ç›®æ¨¡å—
| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ |
|------|------|------|
| POST | /api/projects | åˆ›å»ºé¡¹ç›® |
| GET | /api/projects | è·å–é¡¹ç›®åˆ—è¡¨ |
| GET | /api/projects/{id} | è·å–é¡¹ç›®è¯¦æƒ… |
| PUT | /api/projects/{id} | æ›´æ–°é¡¹ç›® |
| DELETE | /api/projects/{id} | åˆ é™¤é¡¹ç›® |

### RAG æ£€ç´¢æ¨¡å—
| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ |
|------|------|------|
| POST | /api/rag/search | æ··åˆæœç´¢ (çˆ¶å­å—ç­–ç•¥) |
| POST | /api/rag/search/type | æŒ‰æ¥æºç±»å‹æœç´¢ |
| POST | /api/rag/index | ç´¢å¼•å†…å®¹ (çˆ¶å­å—ç»“æ„) |
| GET | /api/rag/chunks/{projectId} | è·å–çŸ¥è¯†å— |
| POST | /api/rag/context | æ„å»ºAIç”Ÿæˆä¸Šä¸‹æ–‡ |


## ğŸ”§ æ ¸å¿ƒç‰¹æ€§

### Virtual Threads (è™šæ‹Ÿçº¿ç¨‹)

```yaml
spring:
  threads:
    virtual:
      enabled: true
```

æ”¯æŒç™¾ä¸‡çº§å¹¶å‘ï¼ŒI/O å¯†é›†å‹ä»»åŠ¡è‡ªåŠ¨ yieldã€‚

### å¤šçº§ç¼“å­˜

```
L1 Caffeine (æœ¬åœ°)     L2 Redis (åˆ†å¸ƒå¼)
â”œâ”€â”€ 10,000 å‘é‡        â”œâ”€â”€ 100,000 å‘é‡
â”œâ”€â”€ 30åˆ†é’Ÿè¿‡æœŸ         â”œâ”€â”€ 1å°æ—¶è¿‡æœŸ
â””â”€â”€ çº³ç§’çº§å“åº”         â””â”€â”€ æ¯«ç§’çº§å“åº”
```

### Function Calling å·¥å…·

```java
@Tool(description = "æœç´¢å°è¯´è®¾å®šå’ŒçŸ¥è¯†åº“")
public List<SearchResult> searchKnowledge(
    @ToolParam(description = "æœç´¢æŸ¥è¯¢è¯") String query,
    @ToolParam(description = "é¡¹ç›®ID") UUID projectId
) {
    return hybridSearchService.search(projectId, query);
}
```

### ç»Ÿä¸€ SSE äº‹ä»¶ç±»å‹

```java
// SSEEventBuilder æä¾›ç»Ÿä¸€çš„äº‹ä»¶æ„å»º
SSEEventBuilder.content("ç”Ÿæˆçš„å†…å®¹")
SSEEventBuilder.thought("WriterAgent", "å¼€å§‹åˆ›ä½œ...")
SSEEventBuilder.toolStart("RAGSearchTool")
SSEEventBuilder.toolEnd("RAGSearchTool", result)
SSEEventBuilder.checkResult(warnings)
SSEEventBuilder.done(tokenUsage)
SSEEventBuilder.error("ç”¨æˆ·å‹å¥½çš„é”™è¯¯ä¿¡æ¯")
```

## ğŸ“Š æ¨¡å—å®ç°çŠ¶æ€

| æ¨¡å— | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| agent | âœ… å®Œæ•´ | ç»Ÿä¸€è·¯ç”±ã€9ç§Agentã€æŠ€èƒ½ç³»ç»Ÿã€å·¥ä½œæµã€ç¼–æ’å™¨ |
| ai_bridge | âœ… å®Œæ•´ | å…¼å®¹å±‚ã€Tool Callingã€SSE |
| auth | âœ… å®Œæ•´ | JWT è®¤è¯ã€ä»¤ç‰Œåˆ·æ–°ã€è´¦æˆ·é”å®š |
| project | âœ… å®Œæ•´ | é¡¹ç›® CRUDã€å¯¼å…¥å¯¼å‡ºã€é˜¶æ®µç®¡ç† |
| content | âœ… å®Œæ•´ | åˆ†å·/ç« èŠ‚/æ•…äº‹å—ã€Lexorank æ’åº |
| character | âœ… å®Œæ•´ | è§’è‰²ç®¡ç†ã€å…³ç³»å›¾è°±ã€åŸå‹ç³»ç»Ÿ |
| wiki | âœ… å®Œæ•´ | çŸ¥è¯†æ¡ç›®ã€åˆ«å/æ ‡ç­¾ã€CDC äº‹ä»¶ |
| plotloop | âœ… å®Œæ•´ | ä¼ç¬”è¿½è¸ªã€çŠ¶æ€æµè½¬ã€ç´§æ€¥æé†’ |
| rag | âœ… å®Œæ•´ | æ··åˆæ£€ç´¢ã€çˆ¶å­ç´¢å¼•ã€è¯­ä¹‰åˆ†å—ã€é…ç½®é©±åŠ¨ç­–ç•¥ã€è‡ªåŠ¨ç´¢å¼•ç”Ÿå‘½å‘¨æœŸ |
| evolution | âœ… å®Œæ•´ | çŠ¶æ€å¿«ç…§ã€ä¸€è‡´æ€§æ£€æŸ¥ã€æ¼”åŒ–åˆ†æ |
| extraction | âœ… å®Œæ•´ | å®ä½“æå–ã€å…³ç³»æ¨æ–­ã€å»é‡ |
| conversation | âœ… å®Œæ•´ | å¯¹è¯å†å²ã€AI æ‘˜è¦ã€æ¸…ç† |
| usage | âœ… å®Œæ•´ | Token ç»Ÿè®¡ã€è´¹ç”¨è®¡ç®—ã€è¶‹åŠ¿ |
| provider | âœ… å®Œæ•´ | AI é…ç½®ã€å¯†é’¥åŠ å¯†ã€å¤šæä¾›å•† |
| style | âœ… å®Œæ•´ | é£æ ¼å­¦ä¹ ã€æ ·æœ¬æ£€ç´¢ã€æç¤ºè¯ |
| snapshot | âœ… å®Œæ•´ | ç« èŠ‚å¿«ç…§ã€è‡ªåŠ¨ä¿å­˜ã€æ¸…ç† |
| ratelimit | âœ… å®Œæ•´ | ç”¨æˆ·çº§é™æµé…ç½®ã€åŠ¨æ€ç«¯ç‚¹è§„åˆ™ |
| session | âœ… å®Œæ•´ | Redis ä¼šè¯æŒä¹…åŒ–ã€å¤šè®¾å¤‡æ”¯æŒ |
| progress | âœ… å®Œæ•´ | è¿›åº¦å¿«ç…§æŒä¹…åŒ–ã€ç»Ÿè®¡ API |
| consistency | âœ… å®Œæ•´ | PostgreSQL CDC è§¦å‘ã€è­¦å‘Šç®¡ç† |
| health | âœ… å®Œæ•´ | å¥åº·æ£€æŸ¥ç«¯ç‚¹ |

## ğŸ“ˆ å¼€å‘è¿›åº¦

### âœ… å·²å®Œæˆ
- [x] Phase 1-15: åŸºç¡€æ¶æ„å’Œä¸šåŠ¡æ¨¡å—
- [x] Phase 16: ç»Ÿä¸€ Agent æ¶æ„
  - AgentRouter ç»Ÿä¸€è·¯ç”±å…¥å£
  - FastPathFilter å¿«é€Ÿè·¯ç”±
  - ThinkingAgent æ„å›¾åˆ†æ (è§„åˆ™å¼•æ“ + å°æ¨¡å‹)
  - WorkflowExecutor å·¥ä½œæµæ‰§è¡Œå™¨
  - AbstractWorkflow å·¥ä½œæµåŸºç±» (preprocess â†’ execute â†’ postprocess)
  - ContentGenerationWorkflow å†…å®¹ç”Ÿæˆå·¥ä½œæµ
  - CreativeDesignWorkflow åˆ›æ„è®¾è®¡å·¥ä½œæµ
  - SimpleAgentWorkflow ç®€å•æ‰§è¡Œå·¥ä½œæµ (é™çº§æ–¹æ¡ˆ)
  - AgentOrchestrator ç»Ÿä¸€ç¼–æ’ï¼ˆå¹¶è¡Œ/é“¾å¼/ç«äº‰ï¼‰
  - ChainExecutionContext é“¾å¼æ‰§è¡Œä¸Šä¸‹æ–‡
  - SSEEventBuilder ç»Ÿä¸€äº‹ä»¶ç±»å‹
  - ActionSkill/PsychologySkill/DescriptionSkill æŠ€èƒ½è¿ç§»
  - PromptInjector æŠ€èƒ½æ³¨å…¥å™¨
- [x] Phase 17: RAG çˆ¶å­å—æ£€ç´¢é›†æˆ
  - HybridSearchService é…ç½®é©±åŠ¨ç­–ç•¥é€‰æ‹©
  - StoryBlockService è‡ªåŠ¨ç´¢å¼•ç”Ÿå‘½å‘¨æœŸ
  - WikiChangeListener äº‹ä»¶é©±åŠ¨ç´¢å¼•
  - çˆ¶å­å—å»é‡ä¸æœ€é«˜åˆ†ä¿ç•™
  - ä¼˜é›…é™çº§åˆ°ä¼ ç»Ÿå‘é‡æ£€ç´¢

### ğŸš§ å¾…å®Œå–„
- [ ] ç›‘æ§å‘Šè­¦: Prometheus + Grafana é›†æˆ

## ğŸ“„ è®¸å¯è¯

MIT License
